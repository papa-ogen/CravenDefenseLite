<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EasyStar JS</title>
</head>
<body>
    
    
    
    <script src='js/vendor/easystar-0.3.0.min.js'></script>
    <script src='js/vendor/phaser.min.js'></script>    
    <script>
            
var game = new Phaser.Game(800, 600, Phaser.AUTO, 'phaser-example', { preload: preload, create: create, update: update });

function preload() {
        game.load.tilemap('stage1', 'assets/maps//test.json', null, Phaser.Tilemap.TILED_JSON);
        game.load.image('tiles', 'assets/maps/grass-tiles-2-small.png', null, Phaser.Tilemap.TILED_JSON);
        game.load.image("monster1", "assets/images/monster1.png");
}

var map;
var layer;
var path;
var monster;
var easystar;

function create() {
    
    easystar = new EasyStar.js();
    
    map = game.add.tilemap("stage1");
    
    map.addTilesetImage('grass-tiles-2-small', 'tiles');
    
    layer = map.createLayer('Background');
    
    easystar.setGrid(map);

    easystar.setIterationsPerCalculation(1000); 

    easystar.setAcceptableTiles([0,2,3,4,5,6,7]);
    easystar.enableCornerCutting();
    easystar.enableDiagonals();

    monster = game.add.sprite(0, 298, "monster1");
    monster.anchor.set(0.5);
    
    console.log(easystar.calculate());
}

function update () {
    
    updateMap(monster);
    
}              

function updateMap(monster) {
    easystar.findPath(monster.x, monster.y, 200, 336, function( path ) {
        var currentNextPointX = 0,
            currentNextPointY = 0,
            speed = 50;
        
        if (path === null) {
            return;
        } 
        
        if (path) {
            currentNextPointX = path[1].x;
            currentNextPointY = path[1].y;
        }
                
        if (currentNextPointX < monster.x && currentNextPointY < monster.y) {
            // left up
                                
	        	monster.body.velocity.x = -speed;
	        	monster.body.velocity.y = 0;
            }
            else if (currentNextPointX == monster.x && currentNextPointY < monster.y)
            {
            // up
                                
	        	monster.body.velocity.y = -speed;
	        	monster.body.velocity.x = -speed;
                                
            }
            else if (currentNextPointX > monster.x && currentNextPointY < monster.y)
            {
            // right up
                                
	        	monster.body.velocity.y = -speed;
	        	monster.body.velocity.x = 0;
                                
        }
        else if (currentNextPointX < monster.x && currentNextPointY == monster.y)
        {
            // left
                                
	        	monster.body.velocity.x = -speed;
	        	monster.body.velocity.y = speed;
                                
        }
        else if (currentNextPointX > monster.x && currentNextPointY == monster.y)
        {
            // right
                                
	        	monster.body.velocity.x = speed;
	        	monster.body.velocity.y = -speed;
                            
        }
        else if (currentNextPointX > monster.x && currentNextPointY > monster.y)
        {
            // right down
                                
	        	monster.body.velocity.x = speed;
	        	monster.body.velocity.y = 0;
                                
        }
        else if (currentNextPointX == monster.x && currentNextPointY > monster.y)
        {
            // down
                                
	        	monster.body.velocity.y = speed;
	        	monster.body.velocity.x = speed;
                                
        }
        else if (currentNextPointX < monster.x && currentNextPointY > monster.y)
        {
            // left down
                                
	        	monster.body.velocity.y = speed;
	        	monster.body.velocity.x = 0;
                                
        }
                            
        easystar.calculate();
    });
}

    </script>
    
</body>
</html>